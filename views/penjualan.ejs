<%- include ('layout/header') %>
<%- include ('layout/navKasir') %>
<div class="content-wrapper" style="background-color: rgb(240, 240, 240);">
<div class="container">
    <div class="row">
        <div class="col-md-6">    
            <table class="table">
                <tr>
                    <td style="border: none;">Nama Kasir : <%= kasir %></td>
                    <td style="border: none;">Kode Penjualan : <%= kode_transaksi %></td>
                </tr>
                <tr>
                    <td style="border: none;"></td>
                    <td style="border: none;">Tanggal Penjualan : <%= tgl %></td>
                </tr>
            </table>            
            <div class="card mt-3 mb-5" style="width: 500px; height: 550px;">
                <div class="card-body">
                    <h6 class="card-title" style="border-bottom: 1px solid rgb(40, 40, 40);">Input Penjualan</h6>
                    <form action="/penjualan/add" method="POST">
                        <div class="mb-3">
                            

                            <label for="InputBayar" class="form-label">Pembayaran</label>
                            <input class="form-control" type="text" placeholder="Tunai" readonly>
                        </div>
                        <div class="mb-3"> 
                            <label for="InputKode" class="form-label">Kode Barang</label>
                                <select id="inputKodeBarang" name="kode_barang" class="form-control">
                                    <option selected disabled>Pilih Kode Barang</option>
                                    <% if (barang && barang.length > 0) { %>
                                        <% barang.forEach(function(item) { %>
                                            <option value="<%= item.kode_barang %>"><%= item.kode_barang %></option>
                                        <% }); %>
                                    <% } else { %>
                                        <option value="">Data barang kosong</option>
                                    <% } %>
                                </select>
                            <input type="hidden" id="InputNamaBarang" name="nama_barang">
                        </div>
                        <div class="mb-3">
                            <label for="InputQty" class="form-label">Qty</label>
                            <input type="text" class="form-control" id="InputQty" name="qty">
                        </div>
                        <div class="mb-3">
                            <label for="InputHarga" class="form-label">Harga</label>
                            <input  class="form-control" type="text" id="InputHarga" name="harga" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="InputTotal" class="form-label">Total</label>
                            <input  class="form-control" type="text" id="InputTotal" name="total" readonly>
                        </div>
                        <div class="mb-3">
                            <button type="submit" class="btn btn-success me-2">Tambah</button>
                            <button type="button" class="btn btn-danger" onclick="resetForm()">Batal</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mt-4" style="width: 500px; height: 570px;">
                <div class="card-body">
                    <h6 class="card-title" style="border-bottom: 1px solid rgb(40, 40, 40);">Keranjang Penjualan</h6>
                    <div class="table-responsive">
                        <!-- tabel keranjang-->
                        <table class="table table-bordered table-hover text-center" style="width: 100%;">
                            <thead class="bg-light">
                                <tr> 
                                    <th>Nama Barang</th>
                                    <th>Harga</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (keranjang && keranjang.length > 0) { %>
                                    <% keranjang.forEach(function(item) { %>
                                    <tr>
                                        <td><%= item.nama_barang %></td>
                                        <td><%= item.harga %></td>
                                        <td><%= item.qty %></td>
                                        <td><%= item.total %></td>
                                        <td><button onclick="hapusItem('<%= item.kode_barang %>')">Hapus</button></td> 
                                    </tr>
                                <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="5">Keranjang kosong</td>
                                    </tr>
                                <% } %>
                            </tbody>
                    </table>
                </div>
                <form>
                    <div class="form-group row">
                        <label for="inputSubtotal" class="col-sm-3 col-form-label col-form-label-sm">Subtotal</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control form-control-sm">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-3
                         col-form-label col-form-label-sm">Member</div>
                        <div class="col-sm-6 col-form-label col-form-label-sm">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="gridCheck1">
                                <label class="form-check-label" for="gridCheck1">
                                    diskon member 30%
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputPassword3" class="col-sm-3 col-form-label col-form-label-sm"></label>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <select id="inputMember" class="form-control form-control-sm">
                                  <option selected>Masukkan kode member</option>
                                  <option>...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputTotal" class="col-sm-3 col-form-label col-form-label-sm">Total</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control form-control-sm">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputCash" class="col-sm-3 col-form-label col-form-label-sm">Cash</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control form-control-sm">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputKembalian" class="col-sm-3 col-form-label col-form-label-sm">Kembalian</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control form-control-sm">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-6">
                            <button type="submit" class="btn btn-warning">Simpan&Cetak</button>
                        </div>
                    </div>
                </form>
                
                </div>
            </div>
        </div>
    </div>
</div>
</div>


<%- include ('layout/footer') %>

<script>
    var formData = {}; // Objek untuk menyimpan data formulir sementara

    // Fungsi untuk mengumpulkan data formulir saat pengguna mengubahnya
    function simpanDataFormulir() {
        formData.kode_barang = document.getElementById('inputKodeBarang').value;
        formData.qty = document.getElementById('InputQty').value;
        formData.harga = document.getElementById('InputHarga').value;
        formData.total = document.getElementById('InputTotal').value;
    }

    // Event listener untuk input kode barang
    document.getElementById('inputKodeBarang').addEventListener('change', function() {
        simpanDataFormulir();
    });

    // Event listener untuk input qty
    document.getElementById('InputQty').addEventListener('input', function() {
        simpanDataFormulir();
        updateTotal();
    });

    // Event listener untuk input harga
    document.getElementById('InputHarga').addEventListener('input', function() {
        simpanDataFormulir();
        updateTotal();
    });

    // Fungsi untuk menghitung total
    function updateTotal() {
        var harga = parseFloat(formData.harga);
        var qty = parseFloat(formData.qty);
        if (!isNaN(harga) && !isNaN(qty)) {
            var total = harga * qty;
            formData.total = total.toFixed().toString();
            document.getElementById('InputTotal').value = formData.total;
        }
    }

    // Event listener untuk tombol Tambah
    document.getElementById('btnTambah').addEventListener('click', function(event) {
        event.preventDefault();
        simpanDataFormulir();
        tambahKeKeranjang(formData); // Memanggil fungsi untuk menambahkan ke keranjang lokal dengan data formulir
    });

    // Fungsi untuk menambahkan item ke keranjang
function tambahKeKeranjang(formData) {
    // Lakukan AJAX POST request untuk menambahkan data ke keranjang
    fetch('/penjualan/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            kode_transaksi: formData.kode_transaksi, // Menyertakan kode transaksi dari formulir
            kode_barang: formData.kode_barang,
            qty: formData.qty,
            harga: formData.harga,
            total: formData.total
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Respon dari server:', data);
        // Perbarui tampilan setelah data berhasil ditambahkan
        window.location.reload(); // Refresh halaman
    })
    .catch(error => console.error('Error:', error));
}


    // Event listener untuk tombol Submit
    document.getElementById('btnSubmit').addEventListener('click', function(event) {
        event.preventDefault();
        simpanDataFormulir();
        // Setelah Anda mengumpulkan data formulir, Anda dapat mengirimnya ke server di sini
        // Anda dapat menggunakan metode fetch() atau teknik lainnya untuk mengirim data formulir ke server
        console.log('Data formulir siap untuk dikirim:', formData);
    });
</script>
